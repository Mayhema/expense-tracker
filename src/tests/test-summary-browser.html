<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transaction Summary Test</title>

  <!-- Include the CSS files -->
  <link rel="stylesheet" href="../styles/main.css">
  <link rel="stylesheet" href="../styles/transactions.css">

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .test-container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    .test-header {
      color: #333;
      margin-bottom: 15px;
      font-size: 18px;
      font-weight: bold;
    }

    .log-output {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 4px;
      padding: 10px;
      margin-top: 10px;
      white-space: pre-wrap;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
    }

    .status {
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 10px;
      font-weight: bold;
    }

    .status.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .status.warning {
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
  </style>
</head>

<body>
  <div class="test-container">
    <h1>ðŸ§ª Transaction Summary Test</h1>
    <p>This page tests the transaction summary functionality in isolation.</p>

    <div class="test-section">
      <div class="test-header">1. DOM Structure Test</div>
      <div id="domTest" class="status warning">Testing DOM structure...</div>
      <div id="domTestOutput" class="log-output"></div>
    </div>

    <div class="test-section">
      <div class="test-header">2. Transaction Summary Element</div>
      <div id="summaryTest" class="status warning">Testing summary element...</div>
      <div id="summaryTestOutput" class="log-output"></div>
    </div>

    <div class="test-section">
      <div class="test-header">3. Summary Update Test</div>
      <div id="updateTest" class="status warning">Testing summary update...</div>
      <div id="updateTestOutput" class="log-output"></div>
    </div>

    <div class="test-section">
      <div class="test-header">4. Live Transaction Section</div>
      <div class="main-content">
        <!-- This will be populated by the actual transaction container -->
      </div>
    </div>
  </div>

  <script type="module">
    let logOutput = '';

    function log(message) {
      logOutput += message + '\n';
      console.log(message);
    }

    function updateLogOutput(elementId) {
      const element = document.getElementById(elementId);
      if (element) {
        element.textContent = logOutput;
      }
    }

    function setStatus(elementId, status, message) {
      const element = document.getElementById(elementId);
      if (element) {
        element.className = `status ${status}`;
        element.textContent = message;
      }
    }

    // Test 1: DOM Structure
    async function testDOMStructure() {
      logOutput = '';

      try {
        log('ðŸ” Testing DOM structure...');

        // Import the transaction renderer
        const { ensureTransactionContainer } = await import('../ui/transaction/transactionRenderer.js');

        log('âœ… Successfully imported transactionRenderer');

        // Create the transaction container
        const container = ensureTransactionContainer();

        if (!container) {
          throw new Error('Transaction container was not created');
        }

        log('âœ… Transaction container created successfully');

        // Check if the summary element exists
        const summaryElement = document.getElementById('transactionSummary');
        if (!summaryElement) {
          throw new Error('transactionSummary element not found in DOM');
        }

        log('âœ… transactionSummary element found in DOM');

        // Check if it's in the correct location (section-header)
        const sectionHeader = summaryElement.closest('.section-header');
        if (!sectionHeader) {
          throw new Error('transactionSummary is not in section-header');
        }

        log('âœ… transactionSummary is correctly placed in section-header');

        setStatus('domTest', 'success', 'âœ… DOM structure test passed');

      } catch (error) {
        log('âŒ Error: ' + error.message);
        setStatus('domTest', 'error', 'âŒ DOM structure test failed: ' + error.message);
      }

      updateLogOutput('domTestOutput');
    }

    // Test 2: Summary Element
    async function testSummaryElement() {
      logOutput = '';

      try {
        log('ðŸ” Testing summary element...');

        const summaryElement = document.getElementById('transactionSummary');
        if (!summaryElement) {
          throw new Error('transactionSummary element not found');
        }

        log('âœ… Summary element found');
        log('   - Element ID: ' + summaryElement.id);
        log('   - Element class: ' + summaryElement.className);
        log('   - Parent element: ' + summaryElement.parentElement?.tagName);
        log('   - Parent class: ' + summaryElement.parentElement?.className);

        // Check current content
        const currentContent = summaryElement.innerHTML;
        log('   - Current content length: ' + currentContent.length);
        log('   - Current content: ' + currentContent.substring(0, 100) + (currentContent.length > 100 ? '...' : ''));

        setStatus('summaryTest', 'success', 'âœ… Summary element test passed');

      } catch (error) {
        log('âŒ Error: ' + error.message);
        setStatus('summaryTest', 'error', 'âŒ Summary element test failed: ' + error.message);
      }

      updateLogOutput('summaryTestOutput');
    }

    // Test 3: Update Test
    async function testSummaryUpdate() {
      logOutput = '';

      try {
        log('ðŸ” Testing summary update...');

        const { updateTransactionSummary } = await import('../ui/transaction/transactionSummary.js');

        log('âœ… Successfully imported updateTransactionSummary');

        const testTransactions = [
          { id: 1, income: 100, expenses: 0, currency: 'USD', date: '2024-01-01' },
          { id: 2, income: 0, expenses: 50, currency: 'USD', date: '2024-01-02' },
          { id: 3, income: 200, expenses: 0, currency: 'USD', date: '2024-01-03' }
        ];

        log('ðŸ“Š Calling updateTransactionSummary with test data...');

        // Call the function
        updateTransactionSummary(testTransactions);

        // Give it some time to process
        await new Promise(resolve => setTimeout(resolve, 300));

        // Check if summary was updated
        const summaryElement = document.getElementById('transactionSummary');
        if (!summaryElement) {
          throw new Error('Summary element not found after update');
        }

        const summaryContent = summaryElement.innerHTML;
        log('âœ… Summary updated successfully');
        log('   - Content length: ' + summaryContent.length);
        log('   - Contains Income: ' + summaryContent.includes('Income'));
        log('   - Contains Expenses: ' + summaryContent.includes('Expenses'));
        log('   - Contains Net Balance: ' + summaryContent.includes('Net Balance'));
        log('   - Contains values: ' + summaryContent.includes('300.00') + ' (income), ' + summaryContent.includes('50.00') + ' (expenses)');

        if (summaryContent.includes('No transaction data available') || summaryContent.trim() === '') {
          throw new Error('Summary was not updated properly');
        }

        setStatus('updateTest', 'success', 'âœ… Summary update test passed');

      } catch (error) {
        log('âŒ Error: ' + error.message);
        setStatus('updateTest', 'error', 'âŒ Summary update test failed: ' + error.message);
      }

      updateLogOutput('updateTestOutput');
    }

    // Run all tests
    async function runAllTests() {
      await testDOMStructure();
      await new Promise(resolve => setTimeout(resolve, 100));

      await testSummaryElement();
      await new Promise(resolve => setTimeout(resolve, 100));

      await testSummaryUpdate();
    }

    // Run tests when page loads
    window.addEventListener('load', () => {
      setTimeout(runAllTests, 500);
    });
  </script>
</body>

</html>
