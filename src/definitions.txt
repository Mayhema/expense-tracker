# Expense Tracker Project Definitions

## Purpose
The Expense Tracker application helps users manage their expenses by uploading transaction files, categorizing transactions, and visualizing expenses. It provides intelligent features to simplify the process of managing and analyzing financial data.

## Core Functionality
1. **File Upload and Parsing**:
   - Users can upload `.xls`, `.xlsx`, or `.xml` files containing transaction data.
   - The application parses the files and extracts headers and data rows.
   - Each uploaded file is assigned a unique identifier (e.g., SHA-256 hash) to prevent duplicate uploads.

2. **Header Mapping**:
   - Users can map file headers to predefined fields (`Date`, `Income`, `Expenses`, `Description`, etc.).
   - If a file with the same header structure is uploaded again, it is automatically recognized, and the user does not need to define the headers again.

3. **File Merging**:
   - Users can merge multiple files into a unified dataset.
   - Merged files are stored in `localStorage` and can be managed (e.g., added, removed).
   - If a file is removed from the merged list, its associated transaction data is also removed.

4. **Category Management**:
   - Users can define and manage categories for transactions (e.g., `Food`, `Transport`, `Utilities`).
   - Categories are used for filtering and grouping transactions.
   - Rows with descriptions that match previously categorized rows are automatically assigned the same category.

5. **Transaction Management**:
   - Transactions are displayed in a table or list format.
   - Users can filter transactions by category or view uncategorized rows.
   - Users can assign categories to rows, and the assignments are saved persistently in `localStorage`.

6. **Visualization**:
   - A pie chart shows income vs. expenses for selected time periods (e.g., month, quarter, half-year, year).
   - A pie chart shows expenses by category for the same time periods.
   - A timeline chart shows income vs. expenses over time (e.g., by year or half-year).

7. **Smart Features**:
   - **Smart Header Mapping**:
     - The application uses AI to suggest header mappings based on the content of the file.
     - For example, columns with dates are automatically recognized as `Date`, and numeric columns are suggested as `Income` or `Expenses`.
   - **Smart Category Guessing**:
     - The application learns from user input to suggest categories for new rows based on their descriptions.

8. **Dark Mode**:
   - Users can toggle between light and dark themes.

## Future Enhancements (Version 2.0)
1. **Advanced AI Auto-Categorization**:
   - Use machine learning to predict categories for rows based on historical data and user behavior.
2. **Validation**:
   - Validate uploaded files to ensure they meet the required format and structure.
3. **User Accounts**:
   - Add user authentication to allow multiple users to manage their expenses.
4. **Export Functionality**:
   - Allow users to export merged files or transaction data in `.xls` or `.csv` formats.
5. **Mobile Responsiveness**:
   - Optimize the UI for mobile devices.

## Notes
- All major functionality must align with the definitions outlined here.
- Any new major functionality must be added to this file to ensure consistency and clarity.

# AI-Friendly Definitions for Expense Tracker

### ✅ Transaction
An object representing a row in a merged financial dataset.
```json
{
  "date": "2024-01-01",
  "description": "Grocery Store",
  "amount": "-35.99",
  "category": "Food",
  "fileName": "expenses.xlsx"
}
```

### ✅ Category
A label (with a hex color) for grouping transactions.
Stored in `AppState.categories` and localStorage.
```json
{
  "Food": "#FF6384",
  "Transport": "#36A2EB"
}
```

### ✅ Merged File
A single uploaded file, parsed and mapped to transaction fields.
```json
{
  "fileName": "report.csv",
  "headerMapping": ["Date", "Description", "Expenses"],
  "data": [...],
  "headerRow": 1,
  "dataRow": 2,
  "signature": "[\"Date\",\"Amount\"]"
}
```

### ✅ Header Mapping
Maps spreadsheet columns to: `Date`, `Income`, `Expenses`, or `Description`.
Used to normalize different spreadsheet formats.

### ✅ Signature
A stringified version of the header row that uniquely identifies a file format.
```js
const signature = JSON.stringify(headerRow);
```

### ✅ AppState (Shared Global State)
Centralized object to store all session-related data:
```js
AppState = {
  categories: { ... },
  mergedFiles: [ ... ],
  transactions: [ ... ],
  currentCategoryFilters: [ ... ],
  currentFileData: [...],
  currentFileName: "...",
  currentFileSignature: "...",
  savePromptShown: false
};
```

### ✅ Local Storage Keys
- `expenseCategories`
- `mergedFiles`
- `fileFormatMappings`
- `userDefinedHeaders`

### ✅ Component Responsibilities
- `fileHandler.js`: file parsing & merging
- `categoryManager.js`: category CRUD & rendering
- `transactionManager.js`: process, render, assign
- `chartManager.js`: pie and timeline chart rendering
- `mappingsManager.js`: header format management
- `uiManager.js`: UI utilities and merged file list
- `main.js`: initialization, event bindings, glue

### ✅ Toast
Temporary floating UI element for alerts/notifications.
```js
showToast("Upload complete")
```

---
Use these conventions when modifying or extending the app.
All modules should work independently and use `AppState` where needed.

### File Signature
- A JSON-stringified version of the first header row.
- Used to detect file format identity and deduplicate uploads.

### suggestMapping(data)
- Guesses a column's role based on sample data and header name.
- Supports: "Date", "Income", "Expenses", "Description"

### renderHeaderPreview()
- Renders a table with:
  1. First row as headers
  2. Second row as dropdowns for mapping
  3. Third row as sample data

### onSaveHeaders()
- Saves header mapping to localStorage
- Merges file if not already added
- Re-renders transactions

### File Deduplication
- On upload, if a file has the same header signature, it will be:
  - Auto-merged without asking the user again
  - Skipped if already in merged list

### Categories Section
- Add Category button (`➕`)
- Future: Edit modal with rename, color, delete

### New Functions
- `openEditTransactionsModal`: Opens a modal for editing transactions.
- `renderCategoryList`: Renders the categories in the "Categories" section.
- `toggleCategoryFilter`: Toggles the visibility of transactions by category.
- `renderTransactions`: Centralized function for rendering transactions.
- `deleteTransaction`: Deletes a transaction from the list.
